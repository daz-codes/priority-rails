<% content_for :title, "Settings — #{@list.name}" %>

<div class="max-w-lg mx-auto space-y-8 py-4">

  <%# ── List Name ─────────────────────────────── %>
  <section>
    <h2 class="text-lg font-heading font-bold mb-3 border-b border-border-primary pb-2">List Name</h2>
    <%= form_with(model: @list, class: "flex gap-2") do |form| %>
      <%= form.text_field :name, class: "flex-1 min-w-0 px-3 py-2 border border-border-input rounded-lg text-base focus:outline-none focus:border-sky-400 bg-input-bg" %>
      <%= form.submit "Save", class: "px-4 py-2 rounded-full bg-sky-400 text-white font-semibold cursor-pointer hover:bg-sky-500 transition-all duration-100 text-sm" %>
    <% end %>
  </section>

  <%# ── Members ───────────────────────────────── %>
  <section>
    <h2 class="text-lg font-heading font-bold mb-3 border-b border-border-primary pb-2">Members</h2>
    <ul class="list-none p-0 m-0 space-y-2 mb-4">
      <% @list.users.each do |user| %>
        <li class="flex items-center gap-3 px-3 py-2 rounded-lg bg-surface-secondary">
          <span class="size-8 rounded-full bg-sky-400 text-white flex items-center justify-center font-bold text-sm shrink-0"><%= user.email_address[0].upcase %></span>
          <span class="text-sm text-text-secondary truncate"><%= user.email_address %></span>
          <% if user == Current.user %>
            <span class="text-[10px] px-2 py-0.5 rounded-full bg-sky-100 text-sky-600 font-semibold ml-auto">You</span>
          <% end %>
        </li>
      <% end %>
      <% @list.pending_invitations.each do |invite| %>
        <li class="flex items-center gap-3 px-3 py-2 rounded-lg bg-surface-secondary">
          <span class="size-8 rounded-full bg-text-muted text-white flex items-center justify-center font-bold text-sm shrink-0"><%= invite.email[0].upcase %></span>
          <span class="text-sm text-text-tertiary truncate"><%= invite.email %></span>
          <span class="text-[10px] px-2 py-0.5 rounded-full bg-yellow-100 text-yellow-600 font-semibold ml-auto">Pending</span>
        </li>
      <% end %>
    </ul>

    <%= form_with url: add_user_list_path(@list), method: :post, class: "flex gap-2" do |form| %>
      <%= form.email_field :email_address, required: true, placeholder: "Invite by email...", class: "flex-1 min-w-0 px-3 py-2 border border-border-input rounded-lg text-sm focus:outline-none focus:border-sky-400 bg-input-bg" %>
      <%= form.submit "Invite", class: "px-4 py-2 rounded-full bg-sky-400 text-white font-semibold cursor-pointer hover:bg-sky-500 transition-all duration-100 text-sm" %>
    <% end %>
  </section>

  <%# ── Categories ────────────────────────────── %>
  <section>
    <h2 class="text-lg font-heading font-bold mb-3 border-b border-border-primary pb-2">Categories</h2>
    <div class="space-y-2 mb-4">
      <% @list.categories.each do |category| %>
        <%= render "categories/category", list: @list, category: category %>
      <% end %>
    </div>

    <%= form_with url: list_categories_path(@list), method: :post, class: "flex gap-2" do |form| %>
      <%= form.text_field :name, required: true, placeholder: "New category...", class: "flex-1 min-w-0 px-3 py-2 border border-border-input rounded-lg text-sm focus:outline-none focus:border-sky-400 bg-input-bg" %>
      <%= form.submit "Add", class: "px-4 py-2 rounded-full bg-sky-400 text-white font-semibold cursor-pointer hover:bg-sky-500 transition-all duration-100 text-sm" %>
    <% end %>
  </section>

  <div class="flex items-center justify-center gap-4">
    <%= link_to "Back to list", @list, class: "text-sm text-text-tertiary hover:text-text-secondary no-underline", data: { escape_back: true } %>
    <span class="text-text-muted">|</span>
    <%= button_to list_path(@list), method: :delete, class: "inline", data: { turbo_confirm: "Are you sure you want to delete this list and all its tasks?" } do %>
      <span class="text-sm text-red-400 hover:text-red-600 cursor-pointer">Delete list</span>
    <% end %>
  </div>

</div>
