<% highlight = local_assigns[:highlight] %>
<li id="<%= dom_id(task) %>"
    data-id="<%= task.id %>"
    class="group m-0 border-b border-dotted border-border-primary <%= @priority ? 'p-3' : 'p-0' %><%= highlight_class(task.id, highlight) %>">
  <%= turbo_frame_tag "task_frame_#{task.id}" do %>
    <div class="flex items-center w-full cursor-move"
         data-controller="task"
         data-task-url-value="<%= task_path(task) %>">

      <%= check_box_tag "task_checkbox_#{task.id}", "1", task.completed?, class: "task-checkbox", data: { action: "task#toggle" } %>

      <div class="flex-grow min-w-0 <%= 'opacity-50' if task.completed? %>">
        <% strike_color = task.category&.color || "#a5f3fc" %>
        <%= link_to task.description, edit_task_path(task),
            class: "text-base no-underline text-text-primary block whitespace-nowrap overflow-hidden text-ellipsis select-none #{'task-struck' if task.completed?}",
            style: (task.completed? ? "--strike-color: #{strike_color}" : nil) %>
        <% unless @priority %>
          <div class="text-xs text-text-tertiary italic">
            <%= "Snoozed #{snooze_time(task)}" if task.snoozed? %>
            <%= "Completed #{time_ago_in_words(task.completed_on)} ago" if task.completed? %>
            <% if task.recurring? %>
              <span class="<%= 'ml-1' if task.snoozed? || task.completed? %>"><i class="fa-solid fa-arrows-rotate text-[10px]"></i> <%= task.recurrence_label %></span>
            <% end %>
          </div>
        <% end %>
      </div>

      <% unless @priority %>
        <div class="flex flex-col items-end gap-0.5 shrink-0 ml-2">
          <% if task.list.categories.any? %>
            <div class="<%= 'opacity-50' if task.completed? %>">
              <%= render "tasks/category_button", task: task %>
            </div>
          <% end %>
          <% unless task.completed? %>
            <% if Current.user.fat_finger_mode? %>
              <div class="flex items-center gap-1">
                <%= render "tasks/actions_menu", task: task %>
              </div>
              <div class="absolute -left-[9999px] overflow-visible">
                <%= render "tasks/note_button", task: task %>
                <%= render "tasks/recurrence_select", task: task %>
                <%= render task.snoozed? ? "tasks/unsnooze_button" : "tasks/snooze_select", task: task %>
                <%= render "tasks/delete_button", task: task %>
              </div>
            <% else %>
              <div class="flex items-center gap-1">
                <%= render "tasks/note_button", task: task %>
                <%= render "tasks/recurrence_select", task: task %>
                <%= render task.snoozed? ? "tasks/unsnooze_button" : "tasks/snooze_select", task: task %>
                <%= render "tasks/delete_button", task: task %>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    </div>

    <%= render "tasks/note", task: task %>
  <% end %>

</li>
